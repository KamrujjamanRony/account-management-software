<section class="px-10 flex justify-center gap-10">
  <div class="flex flex-col gap-5 w-full border mb-10">
    <div class="w-full border mb-10">
      <h1
        class="text-xl md:text-3xl font-bold text-teal-500 underline text-center mb-5"
      >
        User Form
      </h1>
      <form
        [formGroup]="form"
        (ngSubmit)="onSubmit($event)"
        class="min-w-[400px] mx-auto px-2"
      >
        <!-- userName -->
        <Field label="userName">
          <input
            #inputRef
            type="text"
            [formControl]="getControl('userName')"
            class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer"
            [class.invalid]="
              (getControl('userName').invalid &&
                getControl('userName').touched) ||
              isSubmitted
            "
            placeholder=""
            (keydown.enter)="handleEnterKey($event, 0)"
            required
          />
        </Field>

        <!-- password -->
        <Field label="password">
          <input
            #inputRef
            type="text"
            [formControl]="getControl('password')"
            class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-teal-600 peer"
            [class.invalid]="
              (getControl('password').invalid &&
                getControl('password').touched) ||
              isSubmitted
            "
            placeholder=""
            (keydown.enter)="handleEnterKey($event, 1)"
            required
          />
        </Field>

        <!-- isActive -->
        <div class="flex flex-wrap mb-5">
          <div class="flex items-center me-4">
            <input
              id="active-radio"
              type="radio"
              [formControl]="getControl('isActive')"
              [value]="true"
              name="isActive"
              class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
            />
            <label
              for="active-radio"
              class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"
              >Activate</label
            >
          </div>
          <div class="flex items-center me-4">
            <input
              id="deactivate-radio"
              type="radio"
              [formControl]="getControl('isActive')"
              [value]="false"
              name="isActive"
              class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 focus:ring-red-500 dark:focus:ring-red-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
            />
            <label
              for="deactivate-radio"
              class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"
              >Deactivate</label
            >
          </div>
        </div>

        <div class="flex gap-2">
          <!-- Save -->
          <input
            #inputRef
            type="submit"
            [value]="selectedUser ? 'Update' : 'Save'"
            class="text-white bg-gradient-to-r from-teal-400 via-teal-500 to-teal-600 hover:bg-gradient-to-br focus:ring-1 focus:outline-none focus:ring-teal-300 shadow-lg shadow-teal-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 h-10 w-full"
            (keydown.enter)="handleEnterKey($event, 2)"
          />

          <button
            (click)="formReset($event)"
            class="text-white bg-gradient-to-r from-red-400 via-red-500 to-red-600 hover:bg-gradient-to-br focus:ring-1 focus:outline-none focus:ring-red-300 shadow-lg shadow-red-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 h-10"
          >
            Clear
          </button>
        </div>
      </form>
    </div>

    <div class="w-full border mb-10 px-3 max-h-[50vh] overflow-scroll">
      <h1
        class="text-xl md:text-3xl font-bold text-teal-500 underline text-center"
      >
        User List
      </h1>

      <div class="relative overflow-x-auto shadow-md sm:rounded-lg mt-2">
        <div class="flex items-end gap-2 flex-col md:flex-row px-2">
          <div class="bg-teal-50 w-full max-w-lg">
            <label for="table-search" class="sr-only">Search</label>
            <div class="relative mt-1">
              <div
                class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none"
              >
                <app-search></app-search>
              </div>
              <input
                #searchInput
                type="text"
                id="table-search"
                autocomplete="off"
                class="block ps-10 text-xs text-gray-900 border border-gray-300 rounded bg-gray-50 focus:ring-teal-500 focus:border-teal-500 w-full"
                placeholder="Search"
                (input)="onSearchUser($event)"
                (keydown)="handleSearchKeyDown($event)"
              />
            </div>
          </div>
        </div>

        @if (isLoading$ | async) {
        <p class="text-3xl font-bold text-center p-10 text-teal-600">
          Loading ...
        </p>
        } @else if (hasError$ | async) {
        <p class="text-3xl font-bold text-center p-10 text-red-600">
          There was an error loading data.
        </p>
        } @else if (filteredUserList().length === 0) {
        <p class="text-3xl font-bold text-center p-10 text-orange-600">
          Data is Empty.
        </p>
        } @else {
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-800 mt-2"
        >
          <thead class="text-sm text-gray-100 uppercase bg-gray-800">
            <tr>
              <th scope="col" class="p-1">userName</th>
              <th scope="col" class="p-1">password</th>
              <th scope="col" class="px-1 py-3">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (item of filteredUserList().slice(0,20); track item?.id ||
            $index) {
            <tr
              id="row-{{ $index }}"
              class="bg-teal-50 border-b hover:bg-teal-600 hover:text-white cursor-pointer"
            >
              <td scope="row" class="p-1">
                {{ item?.userName }}
              </td>
              <td class="p-1">
                {{ item?.password }}
              </td>
              <td>
                <button
                  class="text-yellow-400 hover:bg-teal-50 px-1 rounded"
                  (click)="onUpdate(item)"
                >
                  Edit
                </button>
                <button
                  class="text-rose-400 hover:bg-teal-50 px-1 rounded"
                  (click)="onDelete(item.id)"
                >
                  Delete
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
        }
      </div>
    </div>
  </div>

  <div class="w-full mx-auto p-4 bg-teal-100">
    <h2 class="text-lg font-semibold text-teal-700 mb-4">User Access</h2>

    <app-user-access-tree [nodes]="userAccessTree()"></app-user-access-tree>

    <button
      class="mt-4 bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600"
      (click)="savePermissions()"
    >
      Save
    </button>
  </div>
</section>

@if (success()) {
<app-toast-success [title]="success()"></app-toast-success>
}
